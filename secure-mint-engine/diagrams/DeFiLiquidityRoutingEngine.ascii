╔══════════════════════════════════════════════════════════════════════════════╗
║                   DeFi LIQUIDITY ROUTING ENGINE                              ║
║                   Yield Optimization with Risk-Tiered Allocation            ║
╚══════════════════════════════════════════════════════════════════════════════╝

  ┌──────────────────────────────────────────────────────────────────────────┐
  │                      TREASURY SURPLUS                                    │
  │                                                                          │
  │  Source: Reserves exceeding 105% backing ratio                           │
  │  Available: totalReserves - (totalSupply * 1.05)                        │
  │                                                                          │
  │  Constraints:                                                            │
  │  - Never deploy below 105% health factor                                │
  │  - Max 30% of surplus in DeFi at any time                               │
  │  - Emergency recall within 4 hours                                       │
  └─────────────────────────────┬────────────────────────────────────────────┘
                                │
                                ▼
  ┌──────────────────────────────────────────────────────────────────────────┐
  │                    RISK ASSESSMENT MODULE                                │
  │                                                                          │
  │  For each protocol, evaluate:                                            │
  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │
  │  │ Audit    │ │ TVL      │ │ Track    │ │ Smart    │ │ Insurance│     │
  │  │ Status   │ │ History  │ │ Record   │ │ Contract │ │ Coverage │     │
  │  │          │ │          │ │          │ │ Age      │ │          │     │
  │  │ Score:   │ │ Score:   │ │ Score:   │ │ Score:   │ │ Score:   │     │
  │  │ 0-100    │ │ 0-100    │ │ 0-100    │ │ 0-100    │ │ 0-100    │     │
  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │
  │                                                                          │
  │  protocolRisk = weightedAvg(scores)                                     │
  └─────────┬──────────────────┬──────────────────┬─────────────────────────┘
            │                  │                  │
     Low Risk (0-30)    Med Risk (31-60)    High Risk (61-100)
            │                  │                  │
            ▼                  ▼                  ▼
  ╔═════════════════╗ ╔═════════════════╗ ╔═════════════════╗
  ║  LOW RISK TIER  ║ ║  MEDIUM RISK    ║ ║  HIGH RISK TIER ║
  ║  Allocation:    ║ ║  TIER           ║ ║  Allocation:    ║
  ║  60-70%         ║ ║  Allocation:    ║ ║  5-10%          ║
  ║                 ║ ║  25-35%         ║ ║                 ║
  ╠═════════════════╣ ╠═════════════════╣ ╠═════════════════╣
  ║                 ║ ║                 ║ ║                 ║
  ║  ┌───────────┐  ║ ║  ┌───────────┐  ║ ║  ┌───────────┐  ║
  ║  │ Aave v3   │  ║ ║  │ Curve     │  ║ ║  │ New       │  ║
  ║  │ USDC/USDT │  ║ ║  │ 3pool     │  ║ ║  │ Protocols │  ║
  ║  │ APY: 3-5% │  ║ ║  │ APY: 5-8% │  ║ ║  │ APY: 10%+ │  ║
  ║  └───────────┘  ║ ║  └───────────┘  ║ ║  └───────────┘  ║
  ║                 ║ ║                 ║ ║                 ║
  ║  ┌───────────┐  ║ ║  ┌───────────┐  ║ ║  ┌───────────┐  ║
  ║  │ Compound  │  ║ ║  │ Convex    │  ║ ║  │ Emerging  │  ║
  ║  │ v3        │  ║ ║  │ Finance   │  ║ ║  │ Yield     │  ║
  ║  │ APY: 3-5% │  ║ ║  │ APY: 6-9% │  ║ ║  │ Vaults    │  ║
  ║  └───────────┘  ║ ║  └───────────┘  ║ ║  │ APY: 12%+ │  ║
  ║                 ║ ║                 ║ ║  └───────────┘  ║
  ║  ┌───────────┐  ║ ║  ┌───────────┐  ║ ║                 ║
  ║  │ MakerDAO  │  ║ ║  │ Pendle    │  ║ ║  Max exposure:  ║
  ║  │ DSR       │  ║ ║  │ PT/YT     │  ║ ║  2% per protocol║
  ║  │ APY: 3-5% │  ║ ║  │ APY: 5-10%│  ║ ║                 ║
  ║  └───────────┘  ║ ║  └───────────┘  ║ ║                 ║
  ╚════════╤════════╝ ╚════════╤════════╝ ╚════════╤════════╝
           │                   │                   │
           └─────────┬─────────┴─────────┬─────────┘
                     │                   │
                     ▼                   ▼
  ┌──────────────────────────────────────────────────────────────────────────┐
  │                    YIELD COLLECTION                                      │
  │                                                                          │
  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
  │  │ Auto-harvest │  │ Compound     │  │ Claim & swap │                  │
  │  │ (weekly)     │  │ rewards      │  │ reward       │                  │
  │  │              │  │ (if APY >    │  │ tokens to    │                  │
  │  │              │  │  gas cost)   │  │ stablecoins  │                  │
  │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                  │
  └─────────┼─────────────────┼─────────────────┼──────────────────────────┘
            └─────────────────┼─────────────────┘
                              │
                              ▼
  ┌──────────────────────────────────────────────────────────────────────────┐
  │                    YIELD DISTRIBUTION                                    │
  │                                                                          │
  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐      │
  │  │  60%             │  │  25%             │  │  15%             │      │
  │  │  Back to         │  │  Protocol        │  │  Insurance       │      │
  │  │  Treasury        │  │  Revenue         │  │  Fund            │      │
  │  │  (strengthen     │  │  (operations,    │  │  (cover          │      │
  │  │   backing)       │  │   development)   │  │   potential      │      │
  │  │                  │  │                  │  │   losses)        │      │
  │  └──────────────────┘  └──────────────────┘  └──────────────────┘      │
  └──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│  LEGEND                                                                      │
│                                                                              │
│  APY    Annual Percentage Yield     TVL   Total Value Locked                │
│  DSR    DAI Savings Rate            PT/YT Principal/Yield Tokens            │
│  ╔═╗    Risk tier boundary          -->   Flow direction                    │
└──────────────────────────────────────────────────────────────────────────────┘
